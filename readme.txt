=== Edel Booking Pro ===
Contributors: Edel Hearts
Tags: booking, reservation, schedule, appointment
Requires at least: 5.0
Tested up to: 6.4
Stable tag: 1.0.0
License: GPLv2 or later

店舗向けの高度な予約管理システムです。スタッフごとのシフト管理、カスタム料金、予約フォームの項目追加、会員マイページ機能などを備えています。

== 概要 ==

Edel Booking Pro は、美容室、サロン、クリニック、スクールなどの店舗運営に適した予約管理プラグインです。
WordPressサイトにショートコードを貼り付けるだけで、Ajax動作の直感的な予約フォームを設置できます。

管理者側では、スタッフごとの細かいシフト調整（週間スケジュール＋例外設定）、メニュー（サービス）ごとの所要時間やバッファ時間の設定、予約データのCSV出力などが可能です。

== 主な機能 ==

1. フロントエンド予約フォーム
   - ステップ式の予約UI（メニュー選択 -> スタッフ選択 -> 日時選択 -> 情報入力 -> 完了）。
   - Ajaxによるスムーズな画面遷移（ページリロードなし）。
   - カレンダーの空き状況をリアルタイム表示（「◎」「△」「×」またはバー表示）。
   - 会員登録（WordPressユーザー作成）と同時予約が可能。
   - レスポンシブ対応（スマホ最適化）。

2. 予約管理（管理画面）
   - 予約リスト表示（月別絞り込み）。
   - カレンダー表示（スタッフごとの空き状況・シフトの可視化）。
   - 予約データのCSVエクスポート機能。
   - 予約ステータス管理（確定、キャンセル、仮予約、来店済）。
   - 顧客ごとの来店履歴・管理者用メモ機能。

3. スタッフ管理
   - WordPressユーザーをスタッフとして登録。
   - 週間シフト設定（曜日ごとの出勤・退勤時間、定休日）。
   - 例外スケジュール設定（特定の日時のみ休みにする、時間を変更する等）。
   - 担当メニューの設定。
   - スタッフ別カスタム料金（指名料やランク別料金の設定）。

4. メニュー（サービス）管理
   - 所要時間、料金の設定。
   - 前後バッファ時間の設定（準備・片付け時間）。
   - 説明文の登録。

5. 会員マイページ機能
   - ログイン / パスワードリセット機能。
   - 今後の予約確認とキャンセル機能（キャンセル期限設定に従う）。
   - 過去の来店履歴の確認。
   - アカウント設定（パスワード変更）。

6. 高度な設定・カスタマイズ
   - カスタムフィールド機能：予約フォームに任意の入力項目（テキスト、ラジオボタン、セレクトボックス等）を追加可能。
   - メール通知設定：予約確定時、キャンセル時、リマインドメール（Cron連携）の件名・本文を自由に編集可能。
   - 表示設定：料金の非表示、カレンダーの表示モード切り替え（記号/バー）、デフォルト選択の設定。

== インストールと初期設定 ==

1. プラグインの有効化
   - `/wp-content/plugins/edel-booking-pro/` にファイルをアップロードし、管理画面から有効化してください。
   - 有効化時に必要なデータベーステーブルが自動作成されます。

2. メニュー（サービス）の登録
   - 管理画面 > 予約管理 > 「メニュー管理」から、提供するサービスを登録してください。

3. スタッフの登録
   - 管理画面 > 予約管理 > 「スタッフ管理」から、スタッフ（WordPressユーザー）を追加してください。
   - 各スタッフの「設定」ボタンから、シフト（週間スケジュール）と担当メニューを設定してください。

4. ショートコードの設置
   - 固定ページを2つ作成し、以下のショートコードを記述してください。
     - 予約ページ: `[edel_booking]`
     - マイページ: `[edel_mypage]`

5. 一般設定
   - 管理画面 > 予約管理 > 「設定」にて、店舗情報、定休日、キャンセル期限などを設定してください。
   - 「マイページ (固定ページ)」の設定項目で、手順4で作成したマイページを選択してください。

== ショートコード ==

* `[edel_booking]`
  予約フォームを表示します。

* `[edel_mypage]`
  会員用マイページ（ログインフォーム含む）を表示します。

== メールテンプレートタグ ==

設定画面のメール本文で使用できるタグ一覧です。

* `{name}` : お客様のお名前
* `{date}` : 予約日 (例: 2025年12月20日)
* `{time}` : 予約時間 (例: 10:00 - 11:00)
* `{service}` : メニュー名
* `{staff}` : 担当スタッフ名
* `{shop_name}` : 店舗名
* `{note}` : 備考欄の内容
* `{custom_fields}` : 追加したカスタムフィールドの入力内容

== よくある質問 ==

Q. 設定を変更しても保存されません。
A. サーバーのWAF（Web Application Firewall）設定などが影響している場合がありますが、本バージョンではフォーム送信処理を改善し、保存ボタン（edel_save_settings_btn）による明示的な保存処理を実装しています。

Q. リマインドメールが届きません。
A. リマインドメールはWordPressのCron機能（`edel_booking_daily_reminder`）を使用しています。サイトへのアクセスがないとCronが動作しないため、アクセスが少ないサイトでは外部Cronの設定を検討してください。また、送信タイミングは設定画面で「当日朝」「前日朝」などから選択できます。

Q. カレンダーに「×」ばかり表示されます。
A. 以下の点を確認してください。
   1. スタッフのシフト（週間スケジュール）が設定されているか。
   2. そのスタッフが選択したメニューを担当可能になっているか（スタッフ設定）。
   3. 店舗の定休日設定（設定画面）。
   4. すでに予約が埋まっていないか。

== 更新履歴 ==

= 1.0.0 =
* 初回リリース
* スタッフ別シフト、カスタム料金、会員マイページ、CSV出力機能を実装。
* 設定保存処理の不具合を修正。
* カスタムフィールドのバリデーション問題を修正。